{% extends "rundb/data/base.html" %}
{% load url from future %}
{% load pagetools %}
{% load static from staticfiles %}
{% load i18n %}
{% block extra_head %}
<link href="{% static "css/chosen.css"%}" rel="stylesheet"/>
<link href="{% static "resources/bootstrap-select/bootstrap-select.css"%}" rel="stylesheet"/>
<link type="text/css" rel="stylesheet" media="all" href="{% static "resources/jquery-ui-1.9.2.custom/css/smoothness/jquery-ui-1.9.2.custom.min.css"%}" />  <link href="{% static "css/ui.daterangepicker.css"%}" rel="stylesheet"/>
<style type="text/css">
    .search-field {
        display: inline-block;
        zoom: 1;
        *display: inline;
        height: 30px;
        float: left;
        margin: 0 10px 15px 0;
	}
    .search-field-data-source {
        display: inline-block;
        zoom: 1;
        *display: inline;
        height: 30px;
        float: left;
        margin: 0 10px 15px 0;
	}
    .search-field-run {
        display: inline-block;
        zoom: 1;
        *display: inline;
        height: 30px;
        float: left;
        margin: 0 10px 15px 0 ;
    }
    .search-field #rangeA {
        margin: 0;
        width: 140px;
    }
    .search-field select {
        width: 200px;
    }
    .icon-unchecked {
        opacity: 0.25;
        /*Dragging IE into the 21st century*/
        filter: alpha(opacity=25);
    }
    .icon-unchecked:hover {
        opacity: 1.0;
        /*Dragging IE into the 21st century*/
        filter: alpha(opacity=100);
    }
    .k-grid {
        margin-top: 6px;
    }
    .k-grid tr td:first-child a img {
        float:none;
        clear:both;
        margin:0;
    }
    .k-grid tr td:first-child  {
        text-align: center;
    }
    .data-table tr td:last-child {
        overflow: visible;
    }
    .name-shorten {
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #update_status {
        color: gray;
        padding: 5px 0;
        vertical-align: middle;
    }
    .k-grid {
        min-width: 1000px;
    }
    #main_table td {
        word-wrap: break-word;
        white-space: normal;
    }
    #main_table tr td:last-child .btn {
        padding: 2px 4px;
    }
    #main_table tr td:last-child img {
        margin: 0;
    }
    #main_table thead th {
        text-overflow: clip;
        padding-left: 2px;
        padding-right: 2px;
    }
    #toggle_more_columns_container {
        display: inline-block;
    }
    #toggle_more_columns_container.disabled > span {
        display: none;
    }
    #id_star {
        display: none;
    }
    #id_star_img {
        cursor: pointer;
        width: 18px;
        border: 0;
        margin:7px 0px 0px 0px;
    }
    .report-select-dropdown {
        display: inline;
    }
    .report-select-dropdown b.caret{
        opacity: 0.9;
        margin-top: 5px;
    }
</style>
<script type="text/javascript">
  $(document).ready(function () {
    $('.send_to_project').live('click',function (e) {
        e.preventDefault();
        e.stopPropagation();
        $('#error-messages').hide().empty();
        url = $(this).attr('href');
          $('body #modal_projects_select').remove();
        $.get(url, function(data) {
              $('body').append(data);
              $('#action_dropdown').dropdown('toggle')
            $( "#modal_projects_select" ).modal("show");
            return false;
        }).fail(function(data) {
            $('#error-messages').empty().show();
            $('#error-messages').append('<p class="error">{% trans "global.messages.error.label" %}: ' + data.responseText + '</p>');
            console.log("Send to project error:", data);
        });
    });
  });
</script>
{% endblock extra_head %}
{% block sub-nav %}
    <li class="active"><a href="{% url "data" %}">{% trans "global.nav.menu.data.menu.data.label" %}</a></li>
    <li><a href="{% url "projects" %}">{% trans "global.nav.menu.data.menu.projects.label" %}</a></li>
    <li><a href="{% url "datamanagement" %}">{% trans "global.nav.menu.data.menu.datamanagement.label" %}</a></li>
{% endblock sub-nav %}
{%block extra-main-class%}no-padding{%endblock extra-main-class%}
{% block content %}
<div id="data_view" class="content group">
    <div class="pull-right">
        <div class="view-toggle" data-toggle="buttons-radio" style="margin-right: 15px;">
            <a href="#full" id="view_full" class="">{% trans "global.mode.listview.label" %}</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#table" id="view_table" class="active">{% trans "global.mode.tableview.label" %}</a>&nbsp;
            <span id="toggle_more_columns_container">
                <span>(<a id="toggle_more_columns" data-more-text="{% trans "global.mode.tableview.mode.toggle_more_columns.more-columns" %}" data-less-text="{% trans "global.mode.tableview.mode.toggle_more_columns.less-columns" %}">{% trans "global.mode.tableview.mode.toggle_more_columns.more-columns" %}</a>)</span>
            </span>
        </div>
        <small style="display: none;" id="update_status" data-live-on="{% trans "global.mode.live.enable.helptext" %}" data-live-off="{% trans "global.mode.live.disable.helptext" %}" >{% trans "global.mode.live.disable.helptext" %}</small> <a id='live_button' class="btn btn-success" data-live-on="{% trans "global.mode.live.enable" %}" data-live-off="{% trans "global.mode.live.disable" %}">{% trans "global.mode.live.enable" %}</a>
    </div>
    <h1>{% trans "data.title" %}</h1>
    <div id="search_bar" class="" style="margin-top:5px;">
        {%spaceless%}
        <div class="row-fluid">
            <div class="search-field">
                <img rel="tooltip" title="{% trans "data.search_bar.fields.star.title" %}" data-placement="top" id="id_star_img" data-src-checked-true="{% static "resources/img/star_off.png"%}" data-src-checked-false="{% static "resources/img/star-blue.png"%}" src="{% static "resources/img/star_off.png"%}">
                <input id="id_star" name="star" type="checkbox">
                <script type="text/javascript">
                    $(document).ready(function () {
                        $('#id_star_img').click(function (e) {
                            var $checkbox = $("#id_star");
                            if ($checkbox.attr('checked')) {
                                $(this).attr("src", $(this).data('srcChecked' + 'True'));
                                $checkbox.attr('checked', false);
                            } else {
                                $(this).attr("src", $(this).data('srcChecked' + 'False'));
                                $checkbox.attr('checked', true);
                            }
                            $checkbox.change();
                        })
                    });
                </script>
            </div>
        	<div class="input-append search-field-run">
                <label for="searchText" class="hide">Search</label>
                <input id="search_text" type="text" placeholder="{% trans "data.search_bar.fields.search_text.placeholder" %}" style="width: 140px;" rel="tooltip" title="{% trans "data.search_bar.fields.search_text.tooltip" %}" data-delay="500"/>
                <button id="search_text_go" class="btn" type="button" style="margin: 0 0 0 -1px">{% trans "data.search_bar.fields.search_text.label" %}</button>
            </div>
            <div class="search-field">
                <label for="dateRange" class=" hide">{% trans "data.search_bar.fields.dateRange.label" %}</label>
                <input type="text" name="dateRange" id="rangeA" placeholder="{% trans "data.search_bar.fields.dateRange.placeholder" %}" style="width: 134px">
            </div>
            <div class="search-field">
                <label for="id_status" class=" hide">{% trans "data.search_bar.fields.resultStatus.label" %}</label>
                <select id="id_status" name="resultStatus" class="selectpicker" data-width="140px" title="{% trans "data.search_bar.fields.resultStatus.title" %}" data-persist-title="true">
                    <option value="">{% trans "data.search_bar.fields.resultStatus.choice.default" %}</option>
                    <option value="Completed">{% trans "data.search_bar.fields.resultStatus.choice.Completed" %}</option>
                    <option value="Progress">{% trans "data.search_bar.fields.resultStatus.choice.Progress" %}</option>
                    <option value="Error">{% trans "data.search_bar.fields.resultStatus.choice.Error" %}</option>
                    <option value="Other">{% trans "data.search_bar.fields.resultStatus.choice.Other" %}</option>
                </select>
            </div>
            <div class="search-field">
                <label for="id_project" class=" hide">{% trans "data.search_bar.fields.project.label" %}</label>
                <select id="id_project" name="project" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.project.count-selected-text" %}"
                    data-selected-text-format="count" data-width="140px" data-remove-button="false" data-remove-button-title="{% trans "data.search_bar.fields.project.remove-button-title" %}" data-live-search="true"
                    data-live-search-placeholder="{% trans "data.search_bar.fields.project.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;"
                    title="{% trans "data.search_bar.fields.project.title" %}" data-select-all-text="{% trans "data.search_bar.fields.project.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.project.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.project.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for project in search.combined.projects %}
                        <option value="{{ project }}">{{ project }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field-data-source">
                <label for="id_data_source" class=" hide">{% trans "data.search_bar.fields.data_source.label" %}</label>
                <select id="id_data_source" disabled="disabled" name="data_source" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.data_source.count-selected-text" %}" data-selected-text-format="count" data-width="160px" data-live-search-placeholder="{% trans "data.search_bar.fields.data_source.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.data_source.title" %}" data-select-all-text="{% trans "data.search_bar.fields.data_source.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.data_source.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.data_source.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    <option selected value="local">{% trans "data.search_bar.fields.data_source.choice.local" %}</option>
                </select>
            </div>
            <div class="search-field">
                <button id="toggle_more_filters" class="btn btn-primary" type="button" data-more-text="{% trans "data.search_bar.action.toggle_more_filters.more-text" %}" data-less-text="{% trans "data.search_bar.action.toggle_more_filters.less-text" %}">{% trans "data.search_bar.action.toggle_more_filters.more-text" %}</button>
            </div>
            <div class="search-field">
                <button id="clear_filters" class="btn" type="button">{% trans "data.search_bar.action.clear_filters.label" %}</button>
            </div>
            <div class="search-field order-by">
                <label for="order_by" class=" hide">{% trans "data.search_bar.fields.order_by.label" %}</label>
                <select id="order_by" name="order_by" class="selectpicker" title="{% trans "data.search_bar.fields.order_by.title" %}" data-width="170px" data-persist-title="true">
                    <option value="-resultDate">{% trans "data.search_bar.fields.order_by.choice.-resultDate" %}</option>
                    <option value="resultDate">{% trans "data.search_bar.fields.order_by.choice.resultDate" %}</option>
                    <option value="-date">{% trans "data.search_bar.fields.order_by.choice.-date" %}</option>
                    <option value="date">{% trans "data.search_bar.fields.order_by.choice.date" %}</option>
                    <option value="displayName">{% trans "data.search_bar.fields.order_by.choice.expName" %}</option>
                    <option value="-displayName">{% trans "data.search_bar.fields.order_by.choice.-expName" %}</option>
                    <option value="chipType">{% trans "data.search_bar.fields.order_by.choice.chipType" %}</option>
                    <option value="-chipType">{% trans "data.search_bar.fields.order_by.choice.-chipType" %}</option>
                    <option value="flows">{% trans "data.search_bar.fields.order_by.choice.flows" %}</option>
                    <option value="-flows">{% trans "data.search_bar.fields.order_by.choice.-flows" %}</option>
                </select>
            </div>
            <div class="search-field clearfix optional hide">
                <label for="id_sample" class=" hide">{% trans "data.search_bar.fields.sample.label" %}</label>
                <select id="id_sample" name="sample" data-placeholder="{% trans "data.search_bar.fields.sample.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.sample.count-selected-text" %}" data-selected-text-format="count" data-width="194px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.sample.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.sample.title" %}" data-select-all-text="{% trans "data.search_bar.fields.sample.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.sample.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.sample.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for sample in search.experiment.sample %}
                        <option value="{{ sample }}">{{ sample }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_reference" class=" hide">{% trans "data.search_bar.fields.reference.label" %}</label>
                <select id="id_reference" name="reference" data-placeholder="{% trans "data.search_bar.fields.reference.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.reference.count-selected-text" %}" data-selected-text-format="count" data-width="148px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.reference.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.reference.title" %}" data-select-all-text="{% trans "data.search_bar.fields.reference.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.reference.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.reference.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for reference in search.experiment.library %}
                        <option value="{{ reference }}">{{ reference }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_flows" class=" hide">{% trans "data.search_bar.fields.flows.label" %}</label>
                <select id="id_flows" name="flows" data-placeholder="{% trans "data.search_bar.fields.flows.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.flows.count-selected-text" %}" data-selected-text-format="count" data-width="140px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.flows.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.flows.title" %}" data-select-all-text="{% trans "data.search_bar.fields.flows.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.flows.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.flows.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for flows in search.combined.flows %}
                        <option value="{{ flows }}">{{ flows }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_chip" class=" hide">{% trans "data.search_bar.fields.chipType.label" %}</label>
                <select id="id_chip" name="chipType" data-placeholder="{% trans "data.search_bar.fields.chipType.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.chipType.count-selected-text" %}" data-selected-text-format="count" data-width="140px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.chipType.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.chipType.title" %}" data-select-all-text="{% trans "data.search_bar.fields.chipType.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.chipType.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.chipType.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for chip in search.experiment.chipType %}
                        <option value="{{ chip.value }}">{{ chip.display_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_sample_prep" class=" hide">{% trans "data.search_bar.fields.samplePrep.label" %}</label>
                <select id="id_sample_prep" name="samplePrep" data-placeholder="{% trans "data.search_bar.fields.samplePrep.placeholder" %}" class="selectpicker"
                        data-width="160px" data-actions-box="true" data-dropup-auto="false"
                        data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.samplePrep.title" %}"
                        data-select-all-text="{% trans "data.search_bar.fields.samplePrep.select-all-text" %}"
                        data-deselect-all-text="{% trans "data.search_bar.fields.samplePrep.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.samplePrep.none-selected-text" %}" data-persist-title="true"
                        data-option-size="20">
                    <option value="">{% trans "data.search_bar.fields.sampleprep.choice.default" %}</option>
                    <option value="OT">{% trans "data.search_bar.fields.sampleprep.choice.OT" %}</option>
                    <option value="IC">{% trans "data.search_bar.fields.sampleprep.choice.IC" %}</option>
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_pgm" class=" hide">{% trans "data.search_bar.fields.pgmName.label" %}</label>
                <select id="id_pgm" name="pgmName" data-placeholder="{% trans "data.search_bar.fields.pgmName.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.pgmName.count-selected-text" %}" data-selected-text-format="count" data-width="160px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.pgmName.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.pgmName.title" %}" data-select-all-text="{% trans "data.search_bar.fields.pgmName.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.pgmName.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.pgmName.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for pgm in search.experiment.pgmName %}
                        <option value="{{ pgm }}">{{ pgm }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-field optional hide">
                <label for="id_plugin" class=" hide">{% trans "data.search_bar.fields.plugin.label" %}</label>
                <select id="id_plugin" name="plugin" data-placeholder="{% trans "data.search_bar.fields.plugin.placeholder" %}" class="selectpicker" multiple data-move-selected="true" data-count-selected-text="{% trans "data.search_bar.fields.plugin.count-selected-text" %}" data-selected-text-format="count" data-width="160px" data-live-search="true" data-live-search-placeholder="{% trans "data.search_bar.fields.plugin.live-search-placeholder" %}" data-actions-box="true" data-dropup-auto="false" data-dropdown-align-right="auto" style="display:none;" title="{% trans "data.search_bar.fields.plugin.title" %}" data-select-all-text="{% trans "data.search_bar.fields.plugin.select-all-text" %}" data-deselect-all-text="{% trans "data.search_bar.fields.plugin.deselect-all-text" %}" data-none-selected-text="{% trans "data.search_bar.fields.plugin.none-selected-text" %}" data-persist-title="true" data-option-size="20" data-selected-text-format="nmore">
                    {% for plugin in search.combined.plugins %}
                        <option value="{{ plugin }}">{{ plugin }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row-fluid">

            <!--<div class="input-append">
                <input id="debug_url" type="text" placeholder="http://green.itw" style="width: 151px;" /><button id="search" class="btn" type="button" style="margin: 0 0 0 -1px">Debug Search</button>
            </div>-->
        </div>
        {%endspaceless%}
    </div>

    <div id="data_panel"></div>
{% if featureflags.DATA_DOWNLOAD_FILTERED_RESULTS_AS_CSV %}
    <div align='center'><a id="download_csv" href="/data/getCSV.csv">Download filtered results as CSV</a></div>
{% endif %}
    <div id="modal_data_management" title="" class="modal hide">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h3>Title</h3>
        </div>
        <div class="modal-body">
            <div id="modal_data_management_errors" class="alert alert-error hide"></div>
            <form class="form-horizontal" id="modal_data_management_form" method="POST">
                <fieldset>
                    <div class="control-group">
                        <label for="data_management_comments" class="control-label">Comment:</label>
                        <div class="controls">
                            <input id="data_management_comments" type="text"/>
                            <p class="help-block">
                            </p>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Cancel</a>
            <a href="#" class="btn btn-primary">Ok</a>
        </div>

        <script>
            $('#modal_data_management').on("hide", function() {
                $('#modal_data_management .btn_primary').unbind('click');
                $('#data_management_comments').val('');
            });
        </script>
    </div>
</div>

<script src="{% static "js/underscore.js"%}"></script>
<script src="{% static "js/backbone.js"%}"></script>
<script src="{% static "js/chosen.jquery.min.js"%}"></script>
<script src="{% static "resources/bootstrap-select/bootstrap-select.js"%}"></script>
{% include "rundb/common/head_jqueryui_script.html" %}
<!-- iso8601.min.js MUST BE BEFORE date.js so that date.js will place the existing
    iso8601 Date.parse into Date._parse and we're going to use Date._parse within our KendoGrid inside data_tab.js -->
<script type="text/javascript" src="{% static "js/iso8601.min.js"%}"></script>
<script src="{% static "js/date.min.js"%}"></script>
{% include "rundb/common/head_daterangepicker_script.html" %}
<script src="{% static "js/template.min.js"%}"></script>
<script src="{% static "js/compiler.min.js"%}"></script>
<script src="{% static "js/messagebox.min.js"%}"></script>
<script src="{% static "resources/jquery/jQuery.download.min.js"%}"></script>
<script type="text/template" id="experiment_template">
    <div class="run-summary row-fluid">
        <div class="run-name span6">
{% comment %} NOTE: UGLY HACK to use django STATIC_URL here {% endcomment %}
{% raw %}
            <div class="pull-left">
                {{#exp.star}}
{% endraw %}
                    <img src="{% static "resources/img/star-blue.png"%}" border="0" class="completedrun-star" width="18">
{% raw %}
                {{/exp.star}}
                {{^exp.star}}
{% endraw %}
                    <img src="{% static "resources/img/star_off.png"%}" border="0" class="completedrun-star" width="18">
{% raw %}
                {{/exp.star}}

                {{#is_proton}}
{% endraw %}
                    <img style="width: 85px" src="{% static "resources/img/instrument_icons/proton.png"%}" class="pull-left" />
{% raw %}
                {{/is_proton}}
                {{#is_s5}}
{% endraw %}
                    <img style="width: 85px" src="{% static "resources/img/instrument_icons/s5.png"%}" class="pull-left" />
{% raw %}
                {{/is_s5}}
                {{#other_instrument}}
{% endraw %}
                    <img style="width: 85px" src="{% static "resources/img/instrument_icons/pgm.png"%}" class="pull-left" />
{% raw %}
                {{/other_instrument}}
                {{#exp.plan}}<span class="{{exp.plan.runType}} app-icon-completed"></span>{{/exp.plan}}
            </div>
            <h1><span rel="tooltip" title="{{ exp.expName }}"><small>{{{ exp_name_prefix }}}</small>{{ prettyExpName }}</span></h1>
            <h3>{{ exp.pgmName }}</h3>
            <h4>
                <div class="span3">
                    {{#in_progress}}
                        {{progress_flows}}/{{exp.flows}} {% endraw %}{% trans "data.fields.flows.label.lowercase" %}{% raw %}
                        <div class="progress progress-striped">
                            <div class="bar" style="width: {{progress_percent}}%;"></div>
                        </div>
                    {{/in_progress}}
                    {{^in_progress}}{% endraw %}{% trans "data.fields.flows.label" %}{% raw %} {{exp.ftpStatus}}{{/in_progress}}
                </div>
                <div>{{ date_string }}</div>
            </h4>
        </div>
        <div class="span1">
            <img onerror="this.style.display='none';" src="{{url_prefix}}{{king_report.reportLink}}Bead_density_70.png" />
        </div>
        <div class="completedrun-items span3">
            <ul class="unstyled">
                {{#exp.barcodeId}}<li><b>{% endraw %}{% trans "data.fields.barcodeId.label" %}{% raw %}:</b> {{exp.barcodeId}}</li>{{/exp.barcodeId}}
                <li><b>{% endraw %}{% trans "data.fields.references.label" %}{% raw %}:</b>
		    {{ exp.references }}
		</li>
            	{{#exp.sampleSetName}}
                <li><b>{% endraw %}{% trans "data.fields.sampleSetName.label" %}{% raw %}:</b>
    				{{exp.sampleSetName}}
                </li>
    			{{/exp.sampleSetName}}                
                <li><b>{% endraw %}{% trans "data.fields.sample.label" %}{% raw %}:</b> {{ exp.sample }}</li>
                <li><b>{% endraw %}{% trans "data.fields.chipDescription.label" %}{% raw %}:</b> {{ exp.chipDescription }}</li>
                <li><b>{% endraw %}{% trans "data.fields.results.projects.name.label" %}{% raw %}:</b> {{#king_report.projects}}<span class="label">{{name}}</span> {{/king_report.projects}}</li>
            </ul>
        </div>
        <div class="run-actions pull-right">
            <a class="btn btn-tertiary reanalyze-run btn75" href="{{url_prefix}}/report/analyze/{{exp.id}}/0" >{% endraw %}{% trans "data.action.reanalyze" %}{% raw %}</a>
            <a class="btn btn-tertiary btn75" href="{{url_prefix}}/plan/page_plan_edit_run/{{exp.id}}/">{% endraw %}{% trans "data.action.editplan" %}{% raw %}</a>
            {{#comment}}
            <div class="btn-group storage">
				{{#exp.archived}}
				<button type="btn" class="storage" title="Signal Processing Input data has been {{exp.archived}}" disabled>{{exp.archived}}</button>
				{{/exp.archived}}
				{{^exp.archived}}
				<label rel="tooltip" title="Keep data files needed for re-Analysis">
                    <input id="autoExempt_{{exp.id}}" class="storage-exempt" type="checkbox" {{#exp.keep}} checked="checked" {{/exp.keep}}> <b>Keep</b>
                </label>
				{{/exp.archived}}
            </div>
            {{/comment}}
        </div>
    </div>
    <div class="table_container row-fluid"></div>
    {{#exp.notes}}
        <div class="note row-fluid">
            <p>{{exp.notes}}</p>
        </div>
    {{/exp.notes}}
</script>
<script type="text/template" id="report_list_template">
    <table class="data-table table-striped table-dense">
        <thead>
            <tr>
{% endraw %}
                <th>&nbsp;</th>
                <th>{% trans "data.fields.results.resultsName.label" %}</th>
                <th>{% trans "data.fields.results.quality_metrics.q0_reads.label" %}</th>
                <th>{% trans "data.fields.results.quality_metrics.q0_mean_read_length.label" %}</th>
                <th>{% trans "data.fields.results.quality_metrics.q20_bases.label" %}</th>
                <th>{% trans "data.fields.results.quality_metrics.q0_bases.label" %}</th>
                <th>{% trans "data.fields.results.timeStamp.label" %}</th>
                <th>{% trans "data.fields.results.status.label" %}</th>
                <th>&nbsp;</th>
{% raw %}
            </tr>
        </thead>
        <tbody class='reports-top'>
        </tbody>
        <tbody class="reports-more" style="display: none;">
        </tbody>
    </table>
    {{#more_reports}}
        <center><a href="#" class="reports-show-more">{{ more_reports_text }}</a></center>
    {{/more_reports}}
</script>
<script type="text/template" id="report_template">
    {{#report}}
        <td><i class="icon-thumbs-up{{^representative}} icon-unchecked{{/representative}}"></i></td>
        <td><span class="pull-left name-shorten"><a href="{{url_prefix}}/report/{{id}}/" target="_blank" alt="Open report in new tab.">{{resultsName}}</a></span></td>
        <td>{{reads_q20}}</td>
        <td>{{read_length}}</td>
        <td>{{total_q20bp}}</td>
        <td>{{total_q0bp}}</td>
        <td>{{date_string}}</td>
        <td>{{i18nstatus.i18n}}</td>
        <td style="overflow:visible;">
            {{#is_local}}
            <div class="btn-group pull-right">
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
{% endraw %}
                    <img src="{% static "resources/img/gear-active.png"%}" border="0">
{% raw %}
                </a>
                <ul class="dropdown-menu">
                    <li><a class="send_to_project" href="/data/results/{{id}}/project/">{% endraw %}{% trans "data.action.results_to_projects.label" %}{% raw %}</a></li>
                    <li class="divider"></li>
                    <li>
                        <a href="/data/datamanagement/log/{{id}}" class="reportLog" data-pk="{{id}}" data-toggle="modal" data-target="#modal_report_log">
{% endraw %}
                            {% trans "data.action.viewlog.label" %}&nbsp;&nbsp;<img src="{% static "images/View_Log_Blue.png"%}"/>
{% raw %}
                        </a>
                    </li>
                    {% endraw %}
                    {% if request.user.is_staff %}
                    <li class="divider"></li>
                    <li><a href="#" class="dm-actions">{% trans "data.action.dm.label" %}</a></li>
                    {% endif %}
                    {% raw %}
                </ul>
            </div>
            {{/is_local}}
        </td>
    {{/report}}
</script>
<script type="text/template" id="experiment_list_table_template">
    <div id="experiment_list_table"></div>
    <div class="k-widget k-grid table-dense">
        <table id="main_table" class='table-striped'>
            <colgroup>
                <col style="width:2%">
                <col {{#more_columns}}style="width:15%"{{/more_columns}} {{^more_columns}}style="width:22%"{{/more_columns}}><!--Run Name-->
                <col style="width:8%">
                {{#more_columns}}<col style="width:4%">{{/more_columns}}<!--Sample Sets-->
                <col style="width:2%">
                <col style="width:5%">
                <col style="width:5%">
                <col style="width:6%">
                <col style="width:4%">
                <col {{#more_columns}}style="width:11%"{{/more_columns}} {{^more_columns}}style="width:22%"{{/more_columns}}><!--Report Name-->
                {{#more_columns}}<col style="width:7%">{{/more_columns}}
                {{#more_columns}}<col style="width:6%">{{/more_columns}}
                {{#more_columns}}<col style="width:5%">{{/more_columns}}
                {{#more_columns}}<col style="width:40px">{{/more_columns}}<!--Flows-->
                {{#more_columns}}<col style="width:4%">{{/more_columns}}<!--Total Reads-->
                {{#more_columns}}<col style="width:4%">{{/more_columns}}<!--Mean Read Length-->
                <col style="width:50px">
                <col style="width:54px">
                <col style="width:30px">
            </colgroup>
            <thead class="k-grid-header">
                <tr>
                    <th class="k-header"></th>
                    {% endraw %}<th class="k-header"><a class="sort_link" data-name="expName" href="#">{% trans "data.fields.displayName.label" %}<span class="order_indicator"></span></a></th>{% raw %}
                    {% endraw %}<th class="k-header">{% trans "data.fields.sample.label" %}</th>{% raw %}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.sampleSetName.label" %}</th>{% raw %}{{/more_columns}}
                    {% endraw %}<th class="k-header">{% trans "data.fields.plan.runType.label" %}</th>{% raw %}
                    {% endraw %}<th class="k-header"><a class="sort_link" data-name="date" href="#">{% trans "data.fields.date.label" %}<span class="order_indicator"></span></a></th>{% raw %}
                    {% endraw %}<th class="k-header"><a class="sort_link" data-name="resultDate" href="#">{% trans "data.fields.resultDate.label" %}<span class="order_indicator"><span class="k-icon k-i-arrow-s"></span></span></a></th>{% raw %}
                    {% endraw %}<th class="k-header">{% trans "data.fields.results.status.label" %}</th>{% raw %}
                    {% endraw %}<th class="k-header"><a class="sort_link" data-name="chipType" href="#">{% trans "data.fields.chipDescription.label" %}<span class="order_indicator"></span></a></th>{% raw %}
                    {% endraw %}<th class="k-header">{% trans "data.fields.results.resultsName.label" %}</th>{% raw %}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.results.eas.references.label" %}</th>{% raw %}{{/more_columns}}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.results.eas.barcodeKitName.label" %}</th>{% raw %}{{/more_columns}}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.plan.sampleTubeLabel.label" %}</th>{% raw %}{{/more_columns}}
                    {{#more_columns}}{% endraw %}<th class="k-header"><a class="sort_link" data-name="flows" href="#">{% trans "data.fields.flows.label" %}<span class="order_indicator"></span></a></th>{% raw %}{{/more_columns}}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.results.quality_metrics.q0_reads.label" %}</th>{% raw %}{{/more_columns}}
                    {{#more_columns}}{% endraw %}<th class="k-header">{% trans "data.fields.results.quality_metrics.q0_mean_read_length.label" %}</th>{% raw %}{{/more_columns}}
                    {% endraw %}<th class="k-header">{% trans "data.fields.results.quality_metrics.q20_bases.label" %}</th>{% raw %}
                    {% endraw %}<th class="k-header">{% trans "data.fields.results.quality_metrics.q0_bases.label" %}</th>{% raw %}
                    <th class="k-header"></th>
                </tr>
            </thead>
            <tbody id="main_list"></tbody>
        </table>
        <div id="pager" class="k-pager-wrap k-grid-pager k-widget" data-role="pager"></div>
    </div>
</script>
<script type="text/template" id="experiment_table_template">
    <td>
        {{#exp.star}}
{% endraw %}
            <img src="{% static "resources/img/star-blue.png"%}" border="0" class="completedrun-star" width="18">
{% raw %}
        {{/exp.star}}
        {{^exp.star}}
{% endraw %}
            <img src="{% static "resources/img/star_off.png"%}" border="0" class="completedrun-star" width="18">
{% raw %}
        {{/exp.star}}
    </td>
    <td>
        {{{ exp_name_prefix }}}{{ exp.displayName }}
    </td>
    <td class="samples"></td>
    {{#more_columns}}<td>
    	{{#exp.sampleSetName}}
			{{exp.sampleSetName}}
		{{/exp.sampleSetName}}
    </td>{{/more_columns}}
    <td>
        {{#exp.plan}}
            <span class="{{exp.plan.runType}}" rel="tooltip" title="{{exp.applicationCategoryDisplayedName}}"></span>
        {{/exp.plan}}
    </td>
    <td>{{ run_date_string }}</td>
    <td>{{ result_date_string }}</td>
    <td>
        {{#in_progress}}
            {{progress_flows}}/{{exp.flows}} flows
            <div class="progress progress-striped">
                <div class="bar" style="width: {{progress_percent}}%;"></div>
            </div>
        {{/in_progress}}
        {{^in_progress}}{{ king_report.i18nstatus.i18n }}{{/in_progress}}
    </td>
    <td>{{ exp.chipDescription }}</td>
    <td style="overflow: visible;">
        {{#king_report}}
            <a href="{{url_prefix}}/report/{{king_report.id}}/" alt="Open report in new window." title="{{king_report.resultsName}}">{{king_report.resultsName}}</a>
        {{/king_report}}
        {{#has_other_reports}}
            <div class="dropdown report-select-dropdown" >
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" title="Other Reports"><b class="caret"></b></a>
                <ul class="dropdown-menu pull-right">
                    {{#other_reports}}
                        <li><a href="{{url_prefix}}/report/{{id}}/" alt="Open report in new window." title="{{resultsName}}">{{resultsName}}</a></li>
                    {{/other_reports}}
                </ul>
            </div>
        {{/has_other_reports}}
    </td>
    {{#more_columns}}<td>{{ king_report.eas.references }}</td>{{/more_columns}}
    {{#more_columns}}<td>{{ king_report.eas.barcodeKitName }}</td>{{/more_columns}}
    {{#more_columns}}<td>
        {{#exp.plan}}
           <span class="{{exp.plan.sampleTubeLabel}}" rel="tooltip" title=""> {{exp.plan.sampleTubeLabel}}</span>
        {{/exp.plan}}
    </td>{{/more_columns}}
    {{#more_columns}}<td>{{ exp.flows }}</td>{{/more_columns}}
    {{#more_columns}}<td>{{ reads_q20 }}</td>{{/more_columns}}
    {{#more_columns}}<td>{{ read_length }}</td>{{/more_columns}}
    <td>{{ total_q20bp }}</td>
    <td>{{ total_q0bp }}</td>
    <td>
        <div class="btn-group pull-right">
{% endraw %}
            <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><img src="{% static "resources/img/gear-active.png"%}" border="0"></a>
{% raw %}
            <ul class="dropdown-menu">
                <li><a href="{{url_prefix}}/report/analyze/{{exp.id}}/0/" class="reanalyze-run">{% endraw %}{% trans "data.action.reanalyze" %}{% raw %}</a></li>
                <li><a href="{{url_prefix}}/plan/page_plan_edit_run/{{exp.id}}/">{% endraw %}{% trans "data.action.editplan" %}{% raw %}</a></li>
            </ul>
        </div>
    </td>
</script>
<script type="text/template" id="pagination_template">
    {{^is_first}}
    <a class="first k-link" title="{{ not_is_first_tooltip }}" href="#" tabindex="-1">
        <span class="k-icon k-i-seek-w">{{ not_is_first_tooltip }}</span>
    </a>
    {{/is_first}}
    {{#is_first}}
    <a class="k-link k-state-disabled" title="{{ is_first_tooltip }}" onclick="return false;" tabindex="-1">
        <span class="k-icon k-i-seek-w">{{ is_first_tooltip }}</span>
    </a>
    {{/is_first}}

    {{#prev}}
    <a class="prev k-link" title="{{ prev_tooltip }}" href="#" tabindex="-1">
        <span class="k-icon k-i-arrow-w">{{ prev_tooltip }}</span>
    </a>
    {{/prev}}
    {{^prev}}
    <a class="k-link k-state-disabled" onclick="return false;" title="{{ not_prev_tooltip }}" tabindex="-1">
        <span class="k-icon k-i-arrow-w">{{ not_prev_tooltip }}</span>
    </a>
    {{/prev}}

    <ul class="k-pager-numbers k-reset">
        {{#page_numbers.prev}}
            <li><a class="page k-link" href="#" data-page="{{page_numbers.prev}}">...</a></li>
        {{/page_numbers.prev}}
        {{#page_numbers.pages}}
            {{^is_current}}
                <li><a class="page k-link" href="#" data-page="{{number}}">{{number}}</a></li>
            {{/is_current}}
            {{#is_current}}
                <li><span class="k-state-selected">{{number}}</span></li>
            {{/is_current}}
        {{/page_numbers.pages}}
        {{#page_numbers.next}}
            <li><a class="page k-link" href="#" data-page="{{page_numbers.next}}">...</a></li>
        {{/page_numbers.next}}
    </ul>
    {{#next}}
        <a class="next k-link" title="{{ next_tooltip }}" href="#" tabindex="-1">
            <span class="k-icon k-i-arrow-e">{{ next_tooltip }}</span>
        </a>
    {{/next}}
    {{^next}}
        <a class="k-link k-state-disabled" onclick="return false;" title="{{ not_next_tooltip }}" tabindex="-1">
            <span class="k-icon k-i-arrow-e">{{ not_next_tooltip }}</span>
        </a>
    {{/next}}
    {{^is_last}}
        <a class="last k-link" title="{{ not_is_last_tooltip }}" href="#" tabindex="-1">
            <span class="k-icon k-i-seek-e">{{ not_is_last_tooltip }}</span>
        </a>
    {{/is_last}}
    {{#is_last}}
        <a class="k-link k-state-disabled" onclick="return false;" title="{{ is_last_tooltip }}" tabindex="-1">
            <span class="k-icon k-i-seek-e">{{ is_last_tooltip }}</span>
        </a>
    {{/is_last}}
    <span class="k-pager-info k-label">{{pager_info}}</span>
</script>
{% endraw %}
<script src="{% static "js/data_models.js"%}"></script>
<script src="{% static "js/data_tab.js"%}"></script>
<script>
    $(function(){
        //inbox = new MessageBox({models: {{global_messages|safe}} });
        //This line loads the Data with the initial page load, elminiating
        //the confusing 'blank page' inital load and a second RTT before data
        //can be loaded.
        var initial_runs = {{inital_query|safe}};
        var pageSize = {{pageSize}};
        exps = new RunList(initial_runs.objects, {
            parse: true,
            limit: pageSize
        });
        exps.total = initial_runs.meta.total_count;
        mainRouter = new RunRouter({server_state: "{{request.session.show_data_tab}}"});
        mainRuns = new RunListView({
            collection: exps,
            router: mainRouter
        });
        if (!Backbone.history.start()) {
            mainRouter.navigate(mainRouter.server_state, {trigger: true});
        }
    });
</script>

{%include "rundb/common/samples_popover_template.html"%}

{% endblock content %}
